(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{"/94A":function(e){e.exports=JSON.parse('{"root":["index","setup"],"References":{"Community articles":"/community/articles","API documentation":"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/index.html","Release notes":"/release-notes"},"Server":["server-basics","server-decorator","server-grpc","server-thrift","server-docservice","server-annotated-service","server-http-file","server-servlet","server-access-log","server-cors","server-sse"],"Client":["client-http","client-thrift","client-grpc","client-decorator","client-retrofit","client-custom-http-headers","client-timeouts","client-retry","client-circuit-breaker","client-service-discovery"],"Advanced":["advanced-logging","advanced-structured-logging","advanced-custom-attributes","advanced-structured-logging-kafka","advanced-unit-testing","advanced-production-checklist","advanced-zipkin","advanced-zookeeper","advanced-saml","advanced-spring-webflux-integration","advanced-dropwizard-integration"]}')},AMUl:function(e){e.exports=JSON.parse('{"data":{"allMdx":{"nodes":[{"tableOfContents":{"items":[{"url":"#requestcontext-custom-attributes","title":"RequestContext custom attributes"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-custom-attributes"}},{"tableOfContents":{"items":[{"url":"#using-armeria-with-dropwizard","title":"Using Armeria with Dropwizard"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-dropwizard-integration"}},{"tableOfContents":{"items":[{"url":"#production-checklist","title":"Production checklist"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-production-checklist"}},{"tableOfContents":{"items":[{"url":"#logging-contextual-information","title":"Logging contextual information"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-logging"}},{"tableOfContents":{"items":[{"url":"#saml-single-sign-on","title":"SAML Single Sign-On"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-saml"}},{"tableOfContents":{"items":[{"url":"#using-armeria-with-spring-webflux","title":"Using Armeria with Spring WebFlux"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-spring-webflux-integration"}},{"tableOfContents":{"items":[{"url":"#structured-logging","title":"Structured logging"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-structured-logging"}},{"tableOfContents":{"items":[{"url":"#unit-testing-client-and-service","title":"Unit-testing Client and Service"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-unit-testing"}},{"tableOfContents":{"items":[{"url":"#zipkin-integration","title":"Zipkin integration"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-zipkin"}},{"tableOfContents":{"items":[{"url":"#service-discovery-with-zookeeper","title":"Service discovery with ZooKeeper"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-zookeeper"}},{"tableOfContents":{"items":[{"url":"#structured-logging-with-kafka","title":"Structured logging with Kafka"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"advanced-structured-logging-kafka"}},{"tableOfContents":{"items":[{"url":"#sending-custom-http-headers","title":"Sending custom HTTP headers"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-custom-http-headers"}},{"tableOfContents":{"items":[{"url":"#decorating-a-client","title":"Decorating a client"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-decorator"}},{"tableOfContents":{"items":[{"url":"#circuit-breaker","title":"Circuit breaker"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-circuit-breaker"}},{"tableOfContents":{"items":[{"url":"#calling-a-grpc-service","title":"Calling a gRPC service"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-grpc"}},{"tableOfContents":{"items":[{"url":"#retrofit-integration","title":"Retrofit integration"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-retrofit"}},{"tableOfContents":{"items":[{"url":"#calling-an-http-service","title":"Calling an HTTP service"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-http"}},{"tableOfContents":{"items":[{"url":"#automatic-retry","title":"Automatic retry"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-retry"}},{"tableOfContents":{"items":[{"url":"#client-side-load-balancing-and-service-discovery","title":"Client-side load balancing and service discovery"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-service-discovery"}},{"tableOfContents":{"items":[{"url":"#calling-a-thrift-service","title":"Calling a Thrift service"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-thrift"}},{"tableOfContents":{"items":[{"url":"#overriding-client-timeouts","title":"Overriding client timeouts"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"client-timeouts"}},{"tableOfContents":{"items":[{"url":"#writing-an-access-log","title":"Writing an access log"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-access-log"}},{"tableOfContents":{"items":[{"url":"#user-manual","title":"User manual"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"index"}},{"tableOfContents":{"items":[{"url":"#annotated-services","title":"Annotated services"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-annotated-service"}},{"tableOfContents":{"items":[{"url":"#server-basics","title":"Server basics"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-basics"}},{"tableOfContents":{"items":[{"url":"#configuring-cors","title":"Configuring CORS"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-cors"}},{"tableOfContents":{"items":[{"url":"#decorating-a-service","title":"Decorating a service"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-decorator"}},{"tableOfContents":{"items":[{"url":"#browsing-and-invoking-services-with-docservice","title":"Browsing and invoking services with DocService"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-docservice"}},{"tableOfContents":{"items":[{"url":"#running-a-grpc-service","title":"Running a gRPC service"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-grpc"}},{"tableOfContents":{"items":[{"url":"#serving-static-files","title":"Serving static files"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-http-file"}},{"tableOfContents":{"items":[{"url":"#embedding-a-servlet-container","title":"Embedding a servlet container"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-servlet"}},{"tableOfContents":{"items":[{"url":"#serving-server-sent-events","title":"Serving Server-Sent Events"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-sse"}},{"tableOfContents":{"items":[{"url":"#running-a-thrift-service","title":"Running a Thrift service"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"server-thrift"}},{"tableOfContents":{"items":[{"url":"#setting-up-a-project","title":"Setting up a project"}]},"parent":{"__typename":"File","sourceInstanceName":"docs","name":"setup"}}]}}}')},"hFX/":function(e,r,t){"use strict";t.r(r),t.d(r,"pageTitle",(function(){return c})),t.d(r,"_frontmatter",(function(){return s})),t.d(r,"default",(function(){return b}));t("8x/H"),t("UsjJ"),t("tKM+"),t("q1tI");var a=t("7ljp"),n=t("xCMr");var i,c="Running a gRPC service",s={},o=(i="Tip",function(e){return console.warn("Component "+i+" was not imported, exported, or provided by MDXProvider as global scope"),Object(a.b)("div",e)}),l={pageTitle:c,_frontmatter:s},p=n.a;function b(e){var r=e.components,t=function(e,r){if(null==e)return{};var t,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],r.indexOf(t)>=0||(n[t]=e[t]);return n}(e,["components"]);return Object(a.b)(p,Object.assign({},l,t,{components:r,mdxType:"MDXLayout"}),Object(a.b)("h1",{id:"running-a-grpc-service",style:{position:"relative"}},Object(a.b)("a",Object.assign({parentName:"h1"},{href:"#running-a-grpc-service","aria-label":"running a grpc service permalink",className:"anchor before"}),Object(a.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(a.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Running a gRPC service"),Object(a.b)("h6",{className:"inlinePageToc",role:"navigation"},"Table of contents"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"#grpcservice"}),"GrpcService")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"#decorating-a-grpcservice"}),"Decorating a GrpcService")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"#grpc-web"}),"gRPC-Web")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"#unframed-requests"}),"Unframed requests")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"#blocking-service-implementation"}),"Blocking service implementation")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"#exception-propagation"}),"Exception propagation")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"#server-reflection"}),"Server Reflection")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"#see-also"}),"See also"))),Object(a.b)(o,{mdxType:"Tip"},Object(a.b)("p",null,"Visit ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/line/armeria-examples"}),"armeria-examples")," to find a fully working example.")),Object(a.b)("p",null,"Let's assume we have the following ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://grpc.io/"}),"gRPC")," service definition:"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-protobuf"}),'syntax = "proto3";\n\npackage grpc.hello;\n\noption java_package = "com.example.grpc.hello";\n\nservice HelloService {\n  rpc Hello (HelloRequest) returns (HelloReply) {}\n}\n\nmessage HelloRequest {\n  string name = 1;\n}\n\nmessage HelloReply {\n  string message = 1;\n}\n')),Object(a.b)("p",null,"The Protobuf compiler will produce some Java code under the ",Object(a.b)("inlineCode",{parentName:"p"},"com.example.grpc.hello")," package.\nThe most noteworthy one is ",Object(a.b)("inlineCode",{parentName:"p"},"HelloServiceGrpc.java")," which defines the base service class we will implement:"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),"public class HelloServiceGrpc {\n    ...\n    public static abstract class HelloServiceImplBase implements BindableService {\n        public void hello(HelloRequest req, StreamObserver<HelloReply> responseObserver) {\n            asyncUnimplementedUnaryCall(METHOD_HELLO, responseObserver);\n        }\n        ...\n    }\n    ...\n}\n")),Object(a.b)("p",null,"Our implementation would look like the following:"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),"public class MyHelloService extends HelloServiceGrpc.HelloServiceImplBase {\n    @Override\n    public void hello(HelloRequest req, StreamObserver<HelloReply> responseObserver) {\n        HelloReply reply = HelloReply.newBuilder()\n                                     .setMessage(\"Hello, \" + req.getName() + '!')\n                                     .build();\n        responseObserver.onNext(reply);\n        responseObserver.onCompleted();\n    }\n}\n")),Object(a.b)(o,{mdxType:"Tip"},Object(a.b)("p",null,"It is recommended to use the build plugin as explained in\n",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/grpc/grpc-java/blob/master/README.md#download"}),"the gRPC-Java README")," rather than\nrunning ",Object(a.b)("inlineCode",{parentName:"p"},"protoc")," manually.")),Object(a.b)("h2",{id:"grpcservice",style:{position:"relative"}},Object(a.b)("a",Object.assign({parentName:"h2"},{href:"#grpcservice","aria-label":"grpcservice permalink",className:"anchor before"}),Object(a.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(a.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),Object(a.b)("inlineCode",{parentName:"h2"},"GrpcService")),Object(a.b)("p",null,"Once you've finished the implementation of the service, you need to build a ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService")," using\na ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcServiceBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcServiceBuilder.html"}),"type://GrpcServiceBuilder")," and add it to the ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://ServerBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServerBuilder.html"}),"type://ServerBuilder"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),"import com.linecorp.armeria.server.Server;\nimport com.linecorp.armeria.server.ServerBuilder;\n\nServerBuilder sb = Server.builder();\n...\nsb.service(GrpcService.builder()\n                      .addService(new MyHelloService())\n                      .build());\n...\nServer server = sb.build();\nserver.start();\n")),Object(a.b)(o,{mdxType:"Tip"},Object(a.b)("p",null,"We bound the ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService")," without specifying any path. It is because ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService"),"\nimplements ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://HttpServiceWithRoutes:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/HttpServiceWithRoutes.html"}),"type://HttpServiceWithRoutes"),", which dynamically provides ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"typeplural://Route:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/Route.html"}),"typeplural://Route")," by itself.")),Object(a.b)("h2",{id:"decorating-a-grpcservice",style:{position:"relative"}},Object(a.b)("a",Object.assign({parentName:"h2"},{href:"#decorating-a-grpcservice","aria-label":"decorating a grpcservice permalink",className:"anchor before"}),Object(a.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(a.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Decorating a ",Object(a.b)("inlineCode",{parentName:"h2"},"GrpcService")),Object(a.b)("p",null,"Unlike a usual Armeria service, ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService")," implements a special interface called\n",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://HttpServiceWithRoutes:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/HttpServiceWithRoutes.html"}),"type://HttpServiceWithRoutes"),". Therefore, it is recommended to decorate a ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService")," by specifying\ndecorator functions as extra parameters rather than using ",Object(a.b)("inlineCode",{parentName:"p"},"Service.decorate()"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),"import com.linecorp.armeria.server.logging.LoggingService;\n\nServerBuilder sb = Server.builder();\n...\nsb.service(GrpcService.builder()\n                      .addService(new MyHelloService())\n                      .build(),\n           LoggingService.newDecorator());\n...\nServer server = sb.build();\nserver.start();\n")),Object(a.b)("p",null,"See ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"/docs/server-decorator#decorating-servicewithroutes"}),"Decorating ",Object(a.b)("inlineCode",{parentName:"a"},"ServiceWithRoutes"))," for more information about ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://HttpServiceWithRoutes:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/HttpServiceWithRoutes.html"}),"type://HttpServiceWithRoutes"),"."),Object(a.b)("h2",{id:"grpc-web",style:{position:"relative"}},Object(a.b)("a",Object.assign({parentName:"h2"},{href:"#grpc-web","aria-label":"grpc web permalink",className:"anchor before"}),Object(a.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(a.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),Object(a.b)("inlineCode",{parentName:"h2"},"gRPC-Web")),Object(a.b)("p",null,Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService")," supports the ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md"}),"gRPC-Web")," protocol,\na small modification to the ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://grpc.io/"}),"gRPC")," wire format that can be used from a browser.\nTo enable it for a ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService"),", add the web formats from\n",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcSerializationFormats:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/grpc/GrpcSerializationFormats.html"}),"type://GrpcSerializationFormats")," to the ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcServiceBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcServiceBuilder.html"}),"type://GrpcServiceBuilder"),". It is usually convenient\nto just pass ",Object(a.b)("inlineCode",{parentName:"p"},"GrpcSerializationFormats.values()"),"."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),"import com.linecorp.armeria.server.grpc.GrpcSerializationFormats;\n\nServerBuilder sb = Server.builder();\n...\nsb.service(GrpcService.builder()\n                      .addService(new MyHelloService())\n                      .supportedSerializationFormats(GrpcSerializationFormats.values())\n                      .build());\n...\nServer server = sb.build();\nserver.start();\n")),Object(a.b)("p",null,"The server will support both native ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://grpc.io/"}),"gRPC")," and ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md"}),"gRPC-Web")," from the same endpoint. Use the unofficial\n",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/improbable-eng/grpc-web"}),"gRPC-Web-Client")," to access the service from a browser. ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md"}),"gRPC-Web")," does not support RPC methods with streaming\nrequests."),Object(a.b)("p",null,"If the origin of the Javascript and API server are different, ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/improbable-eng/grpc-web"}),"gRPC-Web-Client")," first sends ",Object(a.b)("inlineCode",{parentName:"p"},"preflight"),"\nrequests by the HTTP ",Object(a.b)("inlineCode",{parentName:"p"},"OPTIONS")," method, in order to determine whether the actual request is safe to send\nin terms of CORS. Armeria provides ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://CorsService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/cors/CorsService.html"}),"type://CorsService")," to handle this requests, so you need to decorate it when\nyou build a ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),'import com.linecorp.armeria.common.grpc.GrpcHeaderNames;\nimport com.linecorp.armeria.server.cors.CorsService;\nimport com.linecorp.armeria.server.cors.CorsServiceBuilder;\n\nServerBuilder sb = Server.builder();\n...\nfinal CorsServiceBuilder corsBuilder =\n        CorsService.builder("http://foo.com")\n                   .allowRequestMethods(HttpMethod.POST) // Allow POST method.\n                   // Allow Content-type and X-GRPC-WEB headers.\n                   .allowRequestHeaders(HttpHeaderNames.CONTENT_TYPE,\n                                        HttpHeaderNames.of("X-GRPC-WEB"))\n                   // Expose trailers of the HTTP response to the client.\n                   .exposeHeaders(GrpcHeaderNames.GRPC_STATUS,\n                                  GrpcHeaderNames.GRPC_MESSAGE,\n                                  GrpcHeaderNames.ARMERIA_GRPC_THROWABLEPROTO_BIN);\n\nsb.service(GrpcService.builder()\n                      .addService(new MyHelloService())\n                      .supportedSerializationFormats(GrpcSerializationFormats.values())\n                      .build(),\n           corsBuilder.newDecorator(),\n           LoggingService.newDecorator());\n...\nServer server = sb.build();\nserver.start();\n')),Object(a.b)("p",null,"Please refer to ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"/docs/server-cors"}),"Configuring CORS")," for more information."),Object(a.b)("h2",{id:"unframed-requests",style:{position:"relative"}},Object(a.b)("a",Object.assign({parentName:"h2"},{href:"#unframed-requests","aria-label":"unframed requests permalink",className:"anchor before"}),Object(a.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(a.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Unframed requests"),Object(a.b)("p",null,Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService")," supports serving unary RPC methods (no streaming request or response) without ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://grpc.io/"}),"gRPC"),"\nwire format framing. This can be useful for gradually migrating an existing HTTP POST based API to ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://grpc.io/"}),"gRPC"),".\nAs ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"type://GrpcService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html"}),"type://GrpcService")," supports both binary protobuf and ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://developers.google.com/protocol-buffers/docs/proto3#json"}),"Protobuf-JSON"),", either legacy protobuf\nor JSON APIs can be used."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),"ServerBuilder sb = Server.builder();\n...\nsb.service(GrpcService.builder()\n                      .addService(new MyHelloService())\n                      .enableUnframedRequests(true)\n                      // Needed to support JSON in addition to binary\n                      .supportedSerializationFormats(GrpcSerializationFormats.PROTO,\n                                                     GrpcSerializationFormats.JSON)\n                      .build());\n...\nServer server = sb.build();\nserver.start();\n")),Object(a.b)("p",null,"This service's unary methods can be accessed from any HTTP client at e.g., URL ",Object(a.b)("inlineCode",{parentName:"p"},"/grpc.hello.HelloService/Hello"),"\nwith Content-Type ",Object(a.b)("inlineCode",{parentName:"p"},"application/protobuf")," for binary protobuf POST body or ",Object(a.b)("inlineCode",{parentName:"p"},"application/json; charset=utf-8"),"\nfor JSON POST body."),Object(a.b)("h2",{id:"blocking-service-implementation",style:{position:"relative"}},Object(a.b)("a",Object.assign({parentName:"h2"},{href:"#blocking-service-implementation","aria-label":"blocking service implementation permalink",className:"anchor before"}),Object(a.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(a.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Blocking service implementation"),Object(a.b)("p",null,"Unlike upstream gRPC-Java, Armeria does not run service logic in a separate thread pool by default. If your\nservice implementation requires blocking, either run the individual blocking logic in a thread pool, wrap the\nentire service implementation in ",Object(a.b)("inlineCode",{parentName:"p"},"RequestContext.current().blockingTaskExecutor().submit"),", or set\n",Object(a.b)("inlineCode",{parentName:"p"},"GrpcServiceBuilder.useBlockingTaskExecutor()")," so the above happens automatically for all service methods\nand lifecycle callbacks."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),"import com.linecorp.armeria.common.RequestContext;\nimport com.linecorp.armeria.server.ServiceRequestContext;\n\npublic class MyHelloService extends HelloServiceGrpc.HelloServiceImplBase {\n    @Override\n    public void hello(HelloRequest req, StreamObserver<HelloReply> responseObserver) {\n        ServiceRequestContext.current().blockingTaskExecutor().submit(() -> {\n            // Perform a long-running task.\n\n            HelloReply reply = HelloReply.newBuilder()\n                                         .setMessage(\"Hello, \" + req.getName() + '!')\n                                         .build();\n            responseObserver.onNext(reply);\n            responseObserver.onCompleted();\n        });\n    }\n}\n")),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),"import com.linecorp.armeria.common.RequestContext;\nimport com.linecorp.armeria.server.ServiceRequestContext;\n\npublic class MyHelloService extends HelloServiceGrpc.HelloServiceImplBase {\n    @Override\n    public void hello(HelloRequest req, StreamObserver<HelloReply> responseObserver) {\n        // Perform a long-running task.\n\n        HelloReply reply = HelloReply.newBuilder()\n                                     .setMessage(\"Hello, \" + req.getName() + '!')\n                                     .build();\n        responseObserver.onNext(reply);\n        responseObserver.onCompleted();\n    }\n}\n\nServerBuilder sb = Server.builder();\nsb.service(GrpcService.builder()\n                      .addService(new MyHelloService())\n                      // All service methods will be run within\n                      // the blocking executor.\n                      .useBlockingTaskExecutor(true)\n                      .build());\n")),Object(a.b)("h2",{id:"exception-propagation",style:{position:"relative"}},Object(a.b)("a",Object.assign({parentName:"h2"},{href:"#exception-propagation","aria-label":"exception propagation permalink",className:"anchor before"}),Object(a.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(a.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Exception propagation"),Object(a.b)("p",null,"It can be very useful to enable ",Object(a.b)("inlineCode",{parentName:"p"},"Flags.verboseResponses()")," in your server by specifying the\n",Object(a.b)("inlineCode",{parentName:"p"},"-Dcom.linecorp.armeria.verboseResponses=true")," system property, which will automatically return\ninformation about an exception thrown in the server to gRPC clients. Armeria clients will automatically\nconvert it back into an exception for structured logging, etc. This response will include information about\nthe actual source code in the server - make sure it is safe to send such potentially sensitive information\nto all your clients before enabling this flag!"),Object(a.b)("p",null,"See more details at ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"/docs/client-grpc"}),"Client gRPC"),"."),Object(a.b)("h2",{id:"server-reflection",style:{position:"relative"}},Object(a.b)("a",Object.assign({parentName:"h2"},{href:"#server-reflection","aria-label":"server reflection permalink",className:"anchor before"}),Object(a.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(a.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Server Reflection"),Object(a.b)("p",null,"Armeria supports gRPC server reflection - just add an instance of ",Object(a.b)("inlineCode",{parentName:"p"},"ProtoReflectionService")," to your server."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-java"}),"import io.grpc.protobuf.services.ProtoReflectionService;\n\nServerBuilder sb = Server.builder();\n...\nsb.service(GrpcService.builder()\n                      .addService(new MyHelloService())\n                      .addService(ProtoReflectionService.newInstance())\n                      .build());\n...\nServer server = sb.build();\nserver.start();\n")),Object(a.b)("p",null,"For more information, see the official ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/grpc/grpc-java/blob/master/documentation/server-reflection-tutorial.md"}),"gRPC Server Reflection tutorial"),"."),Object(a.b)("h2",{id:"see-also",style:{position:"relative"}},Object(a.b)("a",Object.assign({parentName:"h2"},{href:"#see-also","aria-label":"see also permalink",className:"anchor before"}),Object(a.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(a.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"See also"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"/docs/client-grpc"}),"Client gRPC"))))}b.isMDXComponent=!0},xCMr:function(e,r,t){"use strict";t("UsjJ");var a=t("AMUl"),n=t("q1tI"),i=t.n(n),c=t("/94A"),s=t("+ejy");r.a=function(e){var r=a.data.allMdx.nodes;return i.a.createElement(s.a,Object.assign({},e,{candidateMdxNodes:r,index:c,prefix:"docs",pageTitleSuffix:"Armeria documentation"}))}}}]);
//# sourceMappingURL=component---src-pages-docs-server-grpc-mdx-41e4bf6579067850c574.js.map